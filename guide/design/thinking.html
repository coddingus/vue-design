<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue.js 3 的设计思路 | Vue.js 设计与实现</title>
    <meta name="description" content="《Vue.js 设计与实现》笔记">
    <link rel="stylesheet" href="/vue-design/assets/style.2bc7ae93.css">
    <link rel="modulepreload" href="/vue-design/assets/app.c7e03d4c.js">
    <link rel="modulepreload" href="/vue-design/assets/guide_design_thinking.md.869f86bc.lean.js">
    
    <link rel="icon" type="image/svg+xml" href="/logo.svg">
  <meta name="twitter:title" content="Vue.js 3 的设计思路 | Vue.js 设计与实现">
  <meta property="og:title" content="Vue.js 3 的设计思路 | Vue.js 设计与实现">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-6812f3ed><div class="sidebar-button" data-v-6812f3ed><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/vue-design/" aria-label="Vue.js 设计与实现, back to home" data-v-6812f3ed data-v-0ff9260d><img class="logo" src="/vue-design/logo.svg" alt="Logo" data-v-0ff9260d> Vue.js 设计与实现</a><div class="flex-grow" data-v-6812f3ed></div><div class="nav" data-v-6812f3ed><nav class="nav-links" data-v-6812f3ed data-v-6b0e7b2e><!--[--><div class="item" data-v-6b0e7b2e><div class="nav-link" data-v-6b0e7b2e data-v-4f254c5c><a class="item" href="/vue-design/" data-v-4f254c5c>首页 <!----></a></div></div><div class="item" data-v-6b0e7b2e><div class="nav-link" data-v-6b0e7b2e data-v-4f254c5c><a class="item" href="/vue-design/design/art" data-v-4f254c5c>指南 <!----></a></div></div><div class="item" data-v-6b0e7b2e><div class="nav-dropdown-link" data-v-6b0e7b2e data-v-545685d7><button class="button" data-v-545685d7><span class="button-text" data-v-545685d7>相关链接</span><span class="right button-arrow" data-v-545685d7></span></button><ul class="dialog" data-v-545685d7><!--[--><li class="dialog-item" data-v-545685d7><div class="nav-dropdown-link-item" data-v-545685d7 data-v-6fb9cd60><a class="item isExternal" href="https://vuejs.org" target="_blank" rel="noopener noreferrer" data-v-6fb9cd60><span class="arrow" data-v-6fb9cd60></span><span class="text" data-v-6fb9cd60>Vue.js 文档</span><span class="icon" data-v-6fb9cd60><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-6fb9cd60><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><li class="dialog-item" data-v-545685d7><div class="nav-dropdown-link-item" data-v-545685d7 data-v-6fb9cd60><a class="item isExternal" href="https://v2.vuejs.org" target="_blank" rel="noopener noreferrer" data-v-6fb9cd60><span class="arrow" data-v-6fb9cd60></span><span class="text" data-v-6fb9cd60>Vue.js 2 文档</span><span class="icon" data-v-6fb9cd60><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-6fb9cd60><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-6b0e7b2e><div class="nav-link" data-v-6b0e7b2e data-v-4f254c5c><a class="item isExternal" href="https://github.com/coddingus/vue-design" target="_blank" rel="noopener noreferrer" data-v-4f254c5c>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-4f254c5c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-41228864><nav class="nav-links nav" data-v-41228864 data-v-6b0e7b2e><!--[--><div class="item" data-v-6b0e7b2e><div class="nav-link" data-v-6b0e7b2e data-v-4f254c5c><a class="item" href="/vue-design/" data-v-4f254c5c>首页 <!----></a></div></div><div class="item" data-v-6b0e7b2e><div class="nav-link" data-v-6b0e7b2e data-v-4f254c5c><a class="item" href="/vue-design/design/art" data-v-4f254c5c>指南 <!----></a></div></div><div class="item" data-v-6b0e7b2e><div class="nav-dropdown-link" data-v-6b0e7b2e data-v-545685d7><button class="button" data-v-545685d7><span class="button-text" data-v-545685d7>相关链接</span><span class="right button-arrow" data-v-545685d7></span></button><ul class="dialog" data-v-545685d7><!--[--><li class="dialog-item" data-v-545685d7><div class="nav-dropdown-link-item" data-v-545685d7 data-v-6fb9cd60><a class="item isExternal" href="https://vuejs.org" target="_blank" rel="noopener noreferrer" data-v-6fb9cd60><span class="arrow" data-v-6fb9cd60></span><span class="text" data-v-6fb9cd60>Vue.js 文档</span><span class="icon" data-v-6fb9cd60><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-6fb9cd60><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><li class="dialog-item" data-v-545685d7><div class="nav-dropdown-link-item" data-v-545685d7 data-v-6fb9cd60><a class="item isExternal" href="https://v2.vuejs.org" target="_blank" rel="noopener noreferrer" data-v-6fb9cd60><span class="arrow" data-v-6fb9cd60></span><span class="text" data-v-6fb9cd60>Vue.js 2 文档</span><span class="icon" data-v-6fb9cd60><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-6fb9cd60><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-6b0e7b2e><div class="nav-link" data-v-6b0e7b2e data-v-4f254c5c><a class="item isExternal" href="https://github.com/coddingus/vue-design" target="_blank" rel="noopener noreferrer" data-v-4f254c5c>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-4f254c5c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-41228864><!--[--><li class="sidebar-link"><p class="sidebar-link-item">框架设计概览</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-design/guide/design/art">权衡的艺术</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-design/guide/design/elements">框架设计的核心要素</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/vue-design/guide/design/thinking">Vue.js 3 的设计思路</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#声明式地描述-ui">声明式地描述 UI</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#初识渲染器">初识渲染器</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#组件的本质">组件的本质</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#模板的工作原理">模板的工作原理</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#vue-js-是各个模块组成的有机整体">Vue.js 是各个模块组成的有机整体</a><!----></li></ul></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">响应系统</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-design/guide/reactivity/function-and-realization">响应系统的作用与实现</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-design/guide/reactivity/non-original">非原始值的响应式方案</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/vue-design/guide/reactivity/original">原始值的响应式方案</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-0b036348><div class="container" data-v-0b036348><!--[--><!--]--><div style="position:relative;" class="content" data-v-0b036348><div><h1 id="vue-js-3-的设计思路" tabindex="-1">Vue.js 3 的设计思路 <a class="header-anchor" href="#vue-js-3-的设计思路" aria-hidden="true">#</a></h1><div class="tip custom-block"><p class="custom-block-title">提示</p><p>框架设计讲究全局把控，一个项目就算再大，也是存在一条核心思路，并围绕它展开。</p></div><h2 id="声明式地描述-ui" tabindex="-1">声明式地描述 UI <a class="header-anchor" href="#声明式地描述-ui" aria-hidden="true">#</a></h2><p>Vue.js 3是一个声明式 UI 框架，意思就是用户在开发页面时是声明式地描述 UI 的。</p><p>设计一个声明式的 UI 框架，我该怎么设计呢？为了搞清这个问题，我们需要了解编写前端页面都涉及哪些内容。具体如下</p><table><thead><tr><th>涉及内容</th><th>举例</th><th>Vue.js 3 的解决方案</th></tr></thead><tbody><tr><td><code>DOM</code> 元素</td><td>是 <code>div</code> 、<code>a</code> 还是 <code>span</code> 标签等</td><td>使用与 <code>HTML</code> 标签一致的的方式来描述 <code>DOM</code> 元素。例如描述一个 <code>div</code> 使用 <code>&lt;div&gt;&lt;/div&gt;</code></td></tr><tr><td>属性</td><td><code>a</code>标签的属性 <code>href</code>、<code>id</code>、<code>class</code> 等</td><td>使用与 <code>HTML</code> 标签一致的方式来描述 DOM 属性</td></tr><tr><td>事件</td><td><code>click</code> 、<code>touchmove</code> 等</td><td>使用 <code>@</code> 或 <code>v-on</code> 来描述事件</td></tr><tr><td>元素的层级结构</td><td><code>DOM</code> 树的层级结构，既有子节点，又有父节点</td><td>与 <code>HTML</code> 标签一致的方式来描述层级结构。例如 <code>span</code> 标签既有子节点又有父节点 <br> <code>&lt;div&gt;&lt;span&gt;aaa&lt;span&gt;&lt;/div&gt;</code></td></tr></tbody></table><p>我们可以看到，哪怕是事件，都有与之对应的描述，用户不需要手写任何代码，这就是所谓的声明式地描述 UI</p><p>处理使用模板来声明式的描述 UI 之外，我们还可以使用 JavaScript 对象来描述</p><div class="language-js"><pre><code><span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">onClick</span><span class="token operator">:</span> handler
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&#39;span&#39;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对应到 Vue.js 模板的就是</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handler<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>使用模板与 JavaScript 对象有什么不同呢？因为使用 JavaScript 对象更加灵活。</p><p>假设我们使用 h1~h6 这几个标签，如果使用 JavaScript 对象来描述，只需要一个变量来代表 h 标签即可</p><div class="language-js"><pre><code><span class="token keyword">let</span> level <span class="token operator">=</span> <span class="token number">3</span>
<span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">h</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>level<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果我们使用模板，就不得不枚举</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>level === 1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>level === 2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>level === 3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>level === 4<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h5</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>level === 5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h5</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h6</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>level === 6 <span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h6</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>通过对比，我们就会看到模板远没有 JavaScript 对象灵活。使用 JavaScript 对象描述 UI 的方式，就是我们经常说的<strong>虚拟 DOM</strong> 。</p><p>Vue.js 不仅提供了使用模板描述 UI ，还支持使用虚拟 DOM 描述 UI 。例如我们手写渲染韩式就是使用虚拟 DOM 来描述 UI 的</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> h <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&#39;h1&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">onClick</span><span class="token operator">:</span> handler
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的代码不是 JavaScript 对象啊，它只是调用了 h 函数，传的参数也不像是 JavaScript 对象啊。其实 h 函数返回的就是一个对象，如果我们把 h 函数调用的代码改成 JavaScript 对象，就需要写更多的内容</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&#39;h1&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">onClick</span><span class="token operator">:</span> handler
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>h 函数只是辅助我们更方便我们创建虚拟 DOM 对象而已。</p><div class="tip custom-block"><p class="custom-block-title">什么是组件渲染函数</p><p>一个组件的内容是通过渲染函数来描述的，就是 render 函数， Vue.js 就是根据 render 函数的返回值拿到虚拟 DOM ，然后就可以把组件的内容渲染处理了</p></div><h2 id="初识渲染器" tabindex="-1">初识渲染器 <a class="header-anchor" href="#初识渲染器" aria-hidden="true">#</a></h2><p>我们已经了解了什么是虚拟 DOM ,其实就是使用 JavaScript 对象来描述真实的 DOM 结构。那么虚拟 DOM 是怎么渲染到页面上呢？这就是接下来要讲的渲染器。</p><p><img src="/vue-design/assets/render.e4ae3209.png" alt=""></p><p>假设我们有如下虚拟 DOM</p><div class="language-js"><pre><code><span class="token keyword">const</span> vnode <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;hello&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&#39;hello&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">&#39;click me&#39;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>tag 用来描述标签名称</li><li>props 表示一个对象，用来描述对象的属性、事件等内容</li><li>children 用来描述子节点</li></ul><p>实际上我们可以设计虚拟 DOM ，例如用tagName 代替 tag，因为它本身就是一个 JavaScript 对象</p><p>接下来我们编写一个渲染器</p><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 根据标签名创建对应的 DOM </span>
    <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span>
    <span class="token comment">// 遍历 props 属性，将属性、事件添加到 DOM 上</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> vnode<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> props <span class="token operator">=</span> vnode<span class="token punctuation">.</span>props
        <span class="token comment">// 以 on 开头说明是事件</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^on</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> props<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 设置 DOM 属性</span>
            el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> props<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> children <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children
    <span class="token comment">// children 是字符串，说明是文本节点</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> children <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 存在子节点，挂载子节点</span>
        children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token function">render</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> el<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 将 DOM 添加到容器下</span>
    container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>渲染器的作用不仅仅是创建节点，其精髓都在更新节点阶段。对于渲染器来说，如果内容更改，就应该是更新需要变更的内容，不需要重新走一遍渲染流程。</p><p>例如将上面的 vnode 做一些小更改</p><div class="language-diff"><pre><code>const vnode = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   tag: &#39;div&#39;,
</span><span class="token prefix unchanged"> </span><span class="token line">   props: {
</span><span class="token prefix unchanged"> </span><span class="token line">       onClick: function() {
</span><span class="token prefix unchanged"> </span><span class="token line">           alert(&#39;click&#39;)
</span><span class="token prefix unchanged"> </span><span class="token line">       },
</span><span class="token prefix unchanged"> </span><span class="token line">       class: &#39;hello&#39;
</span><span class="token prefix unchanged"> </span><span class="token line">   },
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    children: &#39;click me again&#39;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    children: &#39;click me&#39;
</span></span>}
</code></pre></div><p>这里我们只需要更新对应的文本内容就可以了</p><h2 id="组件的本质" tabindex="-1">组件的本质 <a class="header-anchor" href="#组件的本质" aria-hidden="true">#</a></h2><p>其实虚拟 DOM 除了能够描述真实 DOM 外，还可以描述组件。<strong>组件就是一组 DOM 元素的封装</strong>，这组 DOM 元素就是组件要渲染的内容。</p><p>因此，我们可以定义一个函数来代表组件，而函数的返回值就能代表组件渲染的内容：</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token function-variable function">myComponent</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&#39;hello&#39;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">&#39;click me&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们可以看到，组件的返回值就是虚拟 DOM ，它代表组件要渲染的内容。搞清了组件的本质，我们再来用虚拟 DOM 来描述组件了。</p><p>我们可以用虚拟 DOM 对象中的 tag 属性来存储组件函数</p><div class="language-js"><pre><code><span class="token keyword">const</span> vnode <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">tag</span><span class="token operator">:</span> MyComponent
<span class="token punctuation">}</span>
</code></pre></div><p>下面来编写渲染函数。实现思路就是根据 tag 属性来判断是不是组件</p><ul><li>如果 tag 是 string 类型，说明 tag 表示是标签名称，直接调用渲染函数就行</li><li>如果是 function 类型，说明是个组件，需要将这个函数返回的结果传递给render函数就可以了</li></ul><p>为了区分，我们可以写两个函数，用来区分是组件还是普通元素。普通元素调用 <code>mountElement</code>，组件渲染调用 <code>mountComponent</code> 实现</p><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> tag <span class="token operator">=</span> vnode<span class="token punctuation">.</span>tag
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> tag <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">mountElement</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> tag <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">mountComponent</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>将原来的 render 函数修改为 <code>mountElement</code> （表示普通元素渲染），组件渲染用新增 <code>mountComponent</code> 方法实现</p><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">mountElement</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 根据标签名创建对应的 DOM </span>
    <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span>
    <span class="token comment">// 遍历 props 属性，将属性、事件添加到 DOM 上</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> vnode<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> props <span class="token operator">=</span> vnode<span class="token punctuation">.</span>props
        <span class="token comment">// 以 on 开头说明是事件</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^on</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> props<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 设置 DOM 属性</span>
            el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> props<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> children <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children
    <span class="token comment">// children 是字符串，说明是文本节点</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> children <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 存在子节点，挂载子节点</span>
        children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">child</span> <span class="token operator">=&gt;</span> <span class="token function">render</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> el<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 将 DOM 添加到容器下</span>
    container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>组件渲染函数实现。实现很简单，就是获取组件返回的虚拟 DOM，直接再次调用 render 函数就行了</p><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> subtree <span class="token operator">=</span> vnode<span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">render</span><span class="token punctuation">(</span>subtree<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>组件一定是函数吗？肯定不是，例如我想使用class、对象等来表示组件。</p><div class="language-js"><pre><code><span class="token comment">// 对象的render函数代码要渲染的内容</span>
<span class="token keyword">const</span> objComponent <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&#39;hello&#39;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">&#39;objComponent&#39;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">ClassComponent</span> <span class="token punctuation">{</span>
    <span class="token comment">// render函数代码要渲染的内容</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">&#39;hello&#39;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token string">&#39;classComponent&#39;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> tag <span class="token operator">=</span> vnode<span class="token punctuation">.</span>tag
    <span class="token keyword">let</span> subtree
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> tag <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 类组件</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^class</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>tag<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> cor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">tag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            subtree <span class="token operator">=</span> cor<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 函数组件</span>
            subtree <span class="token operator">=</span> <span class="token function">tag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> tag <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 对象组件</span>
        subtree <span class="token operator">=</span> tag<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span>subtree<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="模板的工作原理" tabindex="-1">模板的工作原理 <a class="header-anchor" href="#模板的工作原理" aria-hidden="true">#</a></h2><p>我们都了解到，手写虚拟 DOM 还是使用模板，都是声明式地描述 UI 框架。上面了解了虚拟 DOM 是如何转化成真实DOM 的，那么模板是怎么转化的呢？这就是框架的另外一个组成部分： <strong>编译器</strong></p><p>编译器的作用就是将模板编译成渲染函数</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handler<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>click me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>编译后：就会生成与之对应的渲染函数</p><div class="language-js"><pre><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">onClick</span><span class="token operator">:</span> handler
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&#39;click me&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们开发中的 .vue 文件其实就是一个组件</p><div class="language-vue"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handler<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>click me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>最终在浏览器运行的代码就是：</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;ok&#39;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">onClick</span><span class="token operator">:</span> handler
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&#39;click me&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>一个组件无论是模板还是渲染函数，最终都是通过渲染函数产生的，然后将渲染函数产生的虚拟 DOM 转化为真实 DOM 对象。</p><h2 id="vue-js-是各个模块组成的有机整体" tabindex="-1">Vue.js 是各个模块组成的有机整体 <a class="header-anchor" href="#vue-js-是各个模块组成的有机整体" aria-hidden="true">#</a></h2><p>前面我们了解了渲染器和编译器之间的关系，所以这些模块之间是相互关联、相互制约的，共同构成了一个有机的整体</p><p>假设我们有下面模板</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>foo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cls<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>编译器编译后</p><div class="language-js"><pre><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 为了更直观这里没有使用 h 函数，直接返回 h 函数生产的虚拟 DOM 对象</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;foo&#39;</span><span class="token punctuation">,</span>
            <span class="token keyword">class</span><span class="token operator">:</span> cls
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面代码中，我们知道 cls 是一个变量，它会发生变化，渲染器的作用之一就是寻找并只更新变化的内容，所以当 cls 变量发生变化时，渲染器会自动寻找变更点。对于渲染器来说，这个 “寻找” 需要花费一些力气，。对于编译器，它能识别出哪些是动态的，哪些是静态的，在生成代码的时候完全可以附带这些信息</p><div class="language-js"><pre><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 为了更直观这里没有使用 h 函数，直接返回 h 函数生产的虚拟 DOM 对象</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;foo&#39;</span><span class="token punctuation">,</span>
            <span class="token keyword">class</span><span class="token operator">:</span> cls
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">patchFlags</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里 patchFlags 属性，它的值为 1 代码 “class 是动态的” 。对于渲染器来说，它就省去了寻找变更点的工作流，性能就提升了。</p><p>所以，编译器、渲染器都是 Vue.js 的一部分，共同构成一个有机整体，不同模块间的相互配合，进一步提升框架性能</p></div></div><footer class="page-footer" data-v-0b036348 data-v-7fbac81a><div class="edit" data-v-7fbac81a><div class="edit-link" data-v-7fbac81a data-v-fb73da26><!----></div></div><div class="updated" data-v-7fbac81a><!----></div></footer><div class="next-and-prev-link" data-v-0b036348 data-v-57a2b8c7><div class="container" data-v-57a2b8c7><div class="prev" data-v-57a2b8c7><a class="link" href="/vue-design/guide/design/elements" data-v-57a2b8c7><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-57a2b8c7><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-57a2b8c7>框架设计的核心要素</span></a></div><div class="next" data-v-57a2b8c7><a class="link" href="/vue-design/guide/reactivity/function-and-realization" data-v-57a2b8c7><span class="text" data-v-57a2b8c7>响应系统的作用与实现</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-57a2b8c7><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"guide_design_art.md\":\"c0143e81\",\"guide_design_elements.md\":\"8adcdc2d\",\"guide_design_thinking.md\":\"869f86bc\",\"guide_reactivity_function-and-realization.md\":\"be526718\",\"guide_reactivity_non-original.md\":\"7e23c576\",\"guide_reactivity_original.md\":\"1b677156\",\"index.md\":\"13bcec6b\"}")</script>
    <script type="module" async src="/vue-design/assets/app.c7e03d4c.js"></script>
    
  </body>
</html>